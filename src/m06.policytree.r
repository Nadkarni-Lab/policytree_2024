
# ==================================================================================================
# Library
# ==================================================================================================

library(dplyr);
library(tidyr);
library(parallel);
library(policytree);





# ==================================================================================================
# Load
# ==================================================================================================

load("data/mimic.study.20240505.rd");
load("data/mimic.ite.20240505.rd");





# ==================================================================================================
# Preprocessing
# ==================================================================================================

# --------------------------------------------------------------------------------------------------
# Entire data
# --------------------------------------------------------------------------------------------------

d.m_ft_pt <- d.m_ft2[, head(v.m_tau_cf, 25)];

t.m <- tau.m_cf;





# ==================================================================================================
# Policy tree
# ==================================================================================================

pt.m_d5 <- hybrid_policy_tree(
    d.m_ft_pt, t.m, 
    depth=5, search.depth=2, 
    min.node.size=round(nrow(d.m_ft) * 0.005, 0)
);





# ==================================================================================================
# Save
# ==================================================================================================

save(
    # Entire data
    d.m_ft_pt, t.m, pt.m_d5, 
    file = "data/mimic.policytree.20240505.rd"
);









